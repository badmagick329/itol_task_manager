"use strict";(()=>{var d=class{constructor({formId:t,errorBoxId:r,errorMessageId:a,endpoint:i,method:n}){this.validators=[];this.method="POST";let s=document.getElementById(r),c=document.getElementById(a);if(!s||!c)throw new Error(`Error box or message element not found. ${r}, ${a}`);this.formId=t,this.errorBox=s,this.errorMessage=c,this._endpoint=i,n&&(this.method=n)}static formExists(t){let r=document.getElementById(t);return r!==null&&r instanceof HTMLFormElement}tryAttach(){let t=document.getElementById(this.formId);t&&t.addEventListener("submit",async r=>{r.preventDefault();let a=new FormData(t),i={};a.forEach((n,s)=>{typeof n=="string"&&(i[s]=n.trim())});for(let n of this.validators){let s=n(i);if(s){this.showError(s);return}}this.hideError();try{let s=await(await fetch(this.endpoint,{method:this.method,body:a})).json();if(s.error){this.showError(s.error);return}s.redirect&&(window.location.href=s.redirect)}catch{this.showError("Something went wrong \u{1F615}")}})}addValidator(t){this.validators.push(t)}get endpoint(){if(this.method==="POST")return this._endpoint;let t=window.location.href.split("/");return`${this._endpoint}/${t[t.length-1]}`}showError(t){this.errorBox.classList.contains("flex")||(this.errorBox.classList.remove("hidden"),this.errorBox.classList.add("flex")),this.errorMessage.textContent=t}hideError(){this.errorBox.classList.contains("hidden")||(this.errorBox.classList.add("hidden"),this.errorBox.classList.remove("flex"))}},o={required:e=>t=>t[e]?"":`${e} cannot be empty`,minLength:(e,t)=>r=>r[e]&&r[e].length<t?`${e} must be at least ${t} characters long`:"",pattern:(e,t,r)=>a=>a[e]&&!t.test(a[e])?r:"",passwordMatch:(e,t)=>r=>r[e]&&r[t]&&r[e]!==r[t]?"Passwords do not match":"",custom:e=>e};function f(){let e="create-task-form";if(!d.formExists(e))return;let t=new d({formId:e,errorBoxId:"create-task-error",errorMessageId:"create-task-error-message",endpoint:"/task"});t.addValidator(o.required("title")),t.addValidator(o.required("due_date")),t.addValidator(o.required("status")),t.tryAttach()}function p(){let e=document.querySelectorAll("[data-task-status]");if(e.length===0)return;let t=document.getElementById("task-status-filter");t&&t.addEventListener("change",a=>{let i=a.target.value;e.forEach(n=>{let s=n.dataset.taskStatus;i==="All"||s===i?x(n):k(n)})});let r=document.getElementById("task-sorter");r&&r.addEventListener("change",a=>{let i=a.target.value;if(!i)return;let n=e[0].parentElement;if(!n)return;let s=Array.from(e);s.sort((c,u)=>{let l="",m="";switch(i){case"title":return l=c.dataset.taskTitle||"",m=u.dataset.taskTitle||"",l.localeCompare(m);case"status":return l=c.dataset.taskStatus||"",m=u.dataset.taskStatus||"",l.localeCompare(m);case"due_date":return l=c.dataset.taskDueDate||"",m=u.dataset.taskDueDate||"",new Date(l).getTime()-new Date(m).getTime();default:return 0}}),s.forEach(c=>n.appendChild(c))})}function k(e){e.classList.contains("flex")&&(e.classList.add("hidden"),e.classList.remove("flex"))}function x(e){e.classList.contains("hidden")&&(e.classList.remove("hidden"),e.classList.add("flex"))}function g(){let e=document.querySelectorAll("[data-delete-task-id]");e.length!==0&&e.forEach(t=>{t.addEventListener("click",async r=>{r.preventDefault();let a=t.dataset.deleteTaskId;if(!a||!window.confirm("Are you sure you want to delete this task?"))return;let s=await(await fetch(`/task/${a}`,{method:"DELETE"})).json();if(s.error){alert(`Error deleting task: ${s.error}`);return}window.location.reload()})})}function h(){let e="edit-task-form";if(!d.formExists(e))return;let t=new d({formId:e,errorBoxId:"edit-task-error",errorMessageId:"edit-task-error-message",endpoint:"/task",method:"PUT"});t.addValidator(o.required("title")),t.addValidator(o.required("due_date")),t.addValidator(o.required("status")),t.tryAttach()}function E(){let e="login-form";if(!d.formExists(e))return;let t=new d({formId:e,errorBoxId:"login-error",errorMessageId:"login-error-message",endpoint:"/login"});t.addValidator(o.required("username")),t.addValidator(o.required("password")),t.addValidator(o.minLength("password",8)),t.addValidator(o.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),t.tryAttach()}function w(){let e="registration-form";if(!d.formExists(e))return;let t=new d({formId:e,errorBoxId:"register-error",errorMessageId:"register-error-message",endpoint:"/register"});t.addValidator(o.required("username")),t.addValidator(o.required("email")),t.addValidator(o.required("password")),t.addValidator(o.required("password2")),t.addValidator(o.minLength("password",8)),t.addValidator(o.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),t.addValidator(o.pattern("email",/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address")),t.addValidator(o.passwordMatch("password","password2")),t.tryAttach()}function L(){let e=document.getElementById("task-search-form");if(!e)return;console.log(e),e.addEventListener("submit",r=>{r.preventDefault();let a=new FormData(e),i=a.get("title")||"",n=a.get("description")||"",s=new URLSearchParams;i&&s.append("title",i),n&&s.append("description",n),window.location.search=s.toString()});let t=document.getElementById("reset-task-search-button");t&&t.addEventListener("click",()=>{e.reset(),window.location.href=window.location.pathname})}async function y(){console.log("\u{1F913}"),E(),w(),f(),h(),g(),p(),L()}y();})();
