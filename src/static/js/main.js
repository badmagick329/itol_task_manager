"use strict";(()=>{var s=class{constructor({formId:r,errorBoxId:o,errorMessageId:a,endpoint:d,method:n}){this.validators=[];this.method="POST";let i=document.getElementById(o),m=document.getElementById(a);if(!i||!m)throw new Error(`Error box or message element not found. ${o}, ${a}`);this.formId=r,this.errorBox=i,this.errorMessage=m,this._endpoint=d,n&&(this.method=n)}static formExists(r){let o=document.getElementById(r);return o!==null&&o instanceof HTMLFormElement}tryAttach(){let r=document.getElementById(this.formId);r&&r.addEventListener("submit",async o=>{o.preventDefault();let a=new FormData(r),d={};a.forEach((n,i)=>{typeof n=="string"&&(d[i]=n.trim())});for(let n of this.validators){let i=n(d);if(i){this.showError(i);return}}this.hideError();try{let i=await(await fetch(this.endpoint,{method:this.method,body:a})).json();if(i.error){this.showError(i.error);return}i.redirect&&(window.location.href=i.redirect)}catch{this.showError("Something went wrong \u{1F615}")}})}addValidator(r){this.validators.push(r)}get endpoint(){if(this.method==="POST")return this._endpoint;let r=window.location.href.split("/");return`${this._endpoint}/${r[r.length-1]}`}showError(r){this.errorBox.classList.contains("flex")||(this.errorBox.classList.remove("hidden"),this.errorBox.classList.add("flex")),this.errorMessage.textContent=r}hideError(){this.errorBox.classList.contains("hidden")||(this.errorBox.classList.add("hidden"),this.errorBox.classList.remove("flex"))}},e={required:t=>r=>r[t]?"":`${t} cannot be empty`,minLength:(t,r)=>o=>o[t]&&o[t].length<r?`${t} must be at least ${r} characters long`:"",pattern:(t,r,o)=>a=>a[t]&&!r.test(a[t])?o:"",passwordMatch:(t,r)=>o=>o[t]&&o[r]&&o[t]!==o[r]?"Passwords do not match":"",custom:t=>t};function c(){let t="create-task-form";if(!s.formExists(t))return;let r=new s({formId:t,errorBoxId:"create-task-error",errorMessageId:"create-task-error-message",endpoint:"/task"});r.addValidator(e.required("title")),r.addValidator(e.required("due_date")),r.addValidator(e.required("status")),r.tryAttach()}function l(){let t=document.querySelectorAll("[data-delete-task-id]");t.length!==0&&t.forEach(r=>{r.addEventListener("click",async o=>{o.preventDefault();let a=r.dataset.deleteTaskId;if(!a)return;let n=await(await fetch(`/task/${a}`,{method:"DELETE"})).json();if(n.error){alert(`Error deleting task: ${n.error}`);return}window.location.reload()})})}function p(){let t="edit-task-form";if(!s.formExists(t))return;let r=new s({formId:t,errorBoxId:"edit-task-error",errorMessageId:"edit-task-error-message",endpoint:"/task",method:"PUT"});r.addValidator(e.required("title")),r.addValidator(e.required("due_date")),r.addValidator(e.required("status")),r.tryAttach()}function g(){let t="login-form";if(!s.formExists(t))return;let r=new s({formId:t,errorBoxId:"login-error",errorMessageId:"login-error-message",endpoint:"/login"});r.addValidator(e.required("username")),r.addValidator(e.required("password")),r.addValidator(e.minLength("password",8)),r.addValidator(e.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.tryAttach()}function u(){let t="registration-form";if(!s.formExists(t))return;let r=new s({formId:t,errorBoxId:"register-error",errorMessageId:"register-error-message",endpoint:"/register"});r.addValidator(e.required("username")),r.addValidator(e.required("email")),r.addValidator(e.required("password")),r.addValidator(e.required("password2")),r.addValidator(e.minLength("password",8)),r.addValidator(e.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.addValidator(e.pattern("email",/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address")),r.addValidator(e.passwordMatch("password","password2")),r.tryAttach()}async function f(){console.log("\u{1F913}"),g(),u(),c(),p(),l()}f();})();
