"use strict";(()=>{var i=class{constructor({formId:r,errorBoxId:s,errorMessageId:n,endpoint:d,method:a}){this.validators=[];this.method="POST";let o=document.getElementById(s),l=document.getElementById(n);if(!o||!l)throw new Error(`Error box or message element not found. ${s}, ${n}`);this.formId=r,this.errorBox=o,this.errorMessage=l,this._endpoint=d,a&&(this.method=a)}static formExists(r){let s=document.getElementById(r);return s!==null&&s instanceof HTMLFormElement}tryAttach(){let r=document.getElementById(this.formId);r&&r.addEventListener("submit",async s=>{s.preventDefault();let n=new FormData(r),d={};n.forEach((a,o)=>{typeof a=="string"&&(d[o]=a.trim())});for(let a of this.validators){let o=a(d);if(o){this.showError(o);return}}this.hideError();try{let o=await(await fetch(this.endpoint,{method:this.method,body:n})).json();if(o.error){this.showError(o.error);return}o.redirect&&(window.location.href=o.redirect)}catch{this.showError("Something went wrong \u{1F615}")}})}addValidator(r){this.validators.push(r)}get endpoint(){if(this.method==="POST")return this._endpoint;let r=window.location.href.split("/");return`${this._endpoint}/${r[r.length-1]}`}showError(r){this.errorBox.classList.contains("flex")||(this.errorBox.classList.remove("hidden"),this.errorBox.classList.add("flex")),this.errorMessage.textContent=r}hideError(){this.errorBox.classList.contains("hidden")||(this.errorBox.classList.add("hidden"),this.errorBox.classList.remove("flex"))}},e={required:t=>r=>r[t]?"":`${t} cannot be empty`,minLength:(t,r)=>s=>s[t]&&s[t].length<r?`${t} must be at least ${r} characters long`:"",pattern:(t,r,s)=>n=>n[t]&&!r.test(n[t])?s:"",passwordMatch:(t,r)=>s=>s[t]&&s[r]&&s[t]!==s[r]?"Passwords do not match":"",custom:t=>t};function m(){let t="create-task-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"create-task-error",errorMessageId:"create-task-error-message",endpoint:"/task"});r.addValidator(e.required("title")),r.addValidator(e.required("due_date")),r.addValidator(e.required("status")),r.tryAttach()}function c(){let t=document.getElementById("task-status-filter");if(!t)return;let r=document.querySelectorAll("[data-task-status]");r.length!==0&&t.addEventListener("change",s=>{let n=s.target.value;r.forEach(d=>{let a=d.dataset.taskStatus;n==="All"||a===n?E(d):h(d)})})}function h(t){t.classList.contains("flex")&&(t.classList.add("hidden"),t.classList.remove("flex"))}function E(t){t.classList.contains("hidden")&&(t.classList.remove("hidden"),t.classList.add("flex"))}function u(){let t=document.querySelectorAll("[data-delete-task-id]");t.length!==0&&t.forEach(r=>{r.addEventListener("click",async s=>{s.preventDefault();let n=r.dataset.deleteTaskId;if(!n||!window.confirm("Are you sure you want to delete this task?"))return;let o=await(await fetch(`/task/${n}`,{method:"DELETE"})).json();if(o.error){alert(`Error deleting task: ${o.error}`);return}window.location.reload()})})}function f(){let t="edit-task-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"edit-task-error",errorMessageId:"edit-task-error-message",endpoint:"/task",method:"PUT"});r.addValidator(e.required("title")),r.addValidator(e.required("due_date")),r.addValidator(e.required("status")),r.tryAttach()}function p(){let t="login-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"login-error",errorMessageId:"login-error-message",endpoint:"/login"});r.addValidator(e.required("username")),r.addValidator(e.required("password")),r.addValidator(e.minLength("password",8)),r.addValidator(e.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.tryAttach()}function g(){let t="registration-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"register-error",errorMessageId:"register-error-message",endpoint:"/register"});r.addValidator(e.required("username")),r.addValidator(e.required("email")),r.addValidator(e.required("password")),r.addValidator(e.required("password2")),r.addValidator(e.minLength("password",8)),r.addValidator(e.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.addValidator(e.pattern("email",/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address")),r.addValidator(e.passwordMatch("password","password2")),r.tryAttach()}async function L(){console.log("\u{1F913}"),p(),g(),m(),f(),u(),c()}L();})();
