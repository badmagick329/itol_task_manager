"use strict";(()=>{var a=class{constructor({formId:t,errorBoxId:e,errorMessageId:n,endpoint:d,method:i}){this.validators=[];this.method="POST";let o=document.getElementById(e),c=document.getElementById(n);if(!o||!c)throw new Error(`Error box or message element not found. ${e}, ${n}`);this.formId=t,this.errorBox=o,this.errorMessage=c,this._endpoint=d,i&&(this.method=i)}static formExists(t){let e=document.getElementById(t);return e!==null&&e instanceof HTMLFormElement}tryAttach(){let t=document.getElementById(this.formId);t&&t.addEventListener("submit",async e=>{e.preventDefault();let n=new FormData(t),d={};n.forEach((i,o)=>{typeof i=="string"&&(d[o]=i.trim())});for(let i of this.validators){let o=i(d);if(o){this.showError(o);return}}this.hideError();try{let o=await(await fetch(this.endpoint,{method:this.method,body:n})).json();if(o.error){this.showError(o.error);return}o.redirect&&(window.location.href=o.redirect)}catch{this.showError("Something went wrong \u{1F615}")}})}addValidator(t){this.validators.push(t)}get endpoint(){if(this.method==="POST")return this._endpoint;let t=window.location.href.split("/");return`${this._endpoint}/${t[t.length-1]}`}showError(t){this.errorBox.classList.contains("flex")||(this.errorBox.classList.remove("hidden"),this.errorBox.classList.add("flex")),this.errorMessage.textContent=t}hideError(){this.errorBox.classList.contains("hidden")||(this.errorBox.classList.add("hidden"),this.errorBox.classList.remove("flex"))}},s={required:r=>t=>t[r]?"":`${r} cannot be empty`,minLength:(r,t)=>e=>e[r]&&e[r].length<t?`${r} must be at least ${t} characters long`:"",pattern:(r,t,e)=>n=>n[r]&&!t.test(n[r])?e:"",passwordMatch:(r,t)=>e=>e[r]&&e[t]&&e[r]!==e[t]?"Passwords do not match":"",custom:r=>r};function m(){let r="create-task-form";if(!a.formExists(r))return;let t=new a({formId:r,errorBoxId:"create-task-error",errorMessageId:"create-task-error-message",endpoint:"/task"});t.addValidator(s.required("title")),t.addValidator(s.required("due_date")),t.addValidator(s.required("status")),t.tryAttach()}function l(){let r=document.getElementById("task-status-filter");if(!r)return;let t=document.querySelectorAll("[data-task-status]");t.length!==0&&r.addEventListener("change",e=>{let n=e.target.value;t.forEach(d=>{let i=d.dataset.taskStatus;n==="All"||i===n?w(d):E(d)})})}function E(r){r.classList.contains("flex")&&(r.classList.add("hidden"),r.classList.remove("flex"))}function w(r){r.classList.contains("hidden")&&(r.classList.remove("hidden"),r.classList.add("flex"))}function u(){let r=document.querySelectorAll("[data-delete-task-id]");r.length!==0&&r.forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault();let n=t.dataset.deleteTaskId;if(!n||!window.confirm("Are you sure you want to delete this task?"))return;let o=await(await fetch(`/task/${n}`,{method:"DELETE"})).json();if(o.error){alert(`Error deleting task: ${o.error}`);return}window.location.reload()})})}function f(){let r="edit-task-form";if(!a.formExists(r))return;let t=new a({formId:r,errorBoxId:"edit-task-error",errorMessageId:"edit-task-error-message",endpoint:"/task",method:"PUT"});t.addValidator(s.required("title")),t.addValidator(s.required("due_date")),t.addValidator(s.required("status")),t.tryAttach()}function p(){let r="login-form";if(!a.formExists(r))return;let t=new a({formId:r,errorBoxId:"login-error",errorMessageId:"login-error-message",endpoint:"/login"});t.addValidator(s.required("username")),t.addValidator(s.required("password")),t.addValidator(s.minLength("password",8)),t.addValidator(s.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),t.tryAttach()}function g(){let r="registration-form";if(!a.formExists(r))return;let t=new a({formId:r,errorBoxId:"register-error",errorMessageId:"register-error-message",endpoint:"/register"});t.addValidator(s.required("username")),t.addValidator(s.required("email")),t.addValidator(s.required("password")),t.addValidator(s.required("password2")),t.addValidator(s.minLength("password",8)),t.addValidator(s.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),t.addValidator(s.pattern("email",/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address")),t.addValidator(s.passwordMatch("password","password2")),t.tryAttach()}function h(){let r=document.getElementById("task-search-form");if(!r)return;console.log(r),r.addEventListener("submit",e=>{e.preventDefault();let n=new FormData(r),d=n.get("title")||"",i=n.get("description")||"",o=new URLSearchParams;d&&o.append("title",d),i&&o.append("description",i),window.location.search=o.toString()});let t=document.getElementById("reset-task-search-button");t&&t.addEventListener("click",()=>{r.reset(),window.location.href=window.location.pathname})}async function L(){console.log("\u{1F913}"),p(),g(),m(),f(),u(),l(),h()}L();})();
