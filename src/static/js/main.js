"use strict";(()=>{var a=class{constructor({formId:r,errorBoxId:e,errorMessageId:i,endpoint:d,method:n}){this.validators=[];this.method="POST";let o=document.getElementById(e),m=document.getElementById(i);if(!o||!m)throw new Error(`Error box or message element not found. ${e}, ${i}`);this.formId=r,this.errorBox=o,this.errorMessage=m,this.endpoint=d,n&&(this.method=n)}static formExists(r){let e=document.getElementById(r);return e!==null&&e instanceof HTMLFormElement}tryAttach(){let r=document.getElementById(this.formId);r&&r.addEventListener("submit",async e=>{e.preventDefault();let i=new FormData(r),d={};i.forEach((n,o)=>{typeof n=="string"&&(d[o]=n.trim())});for(let n of this.validators){let o=n(d);if(o){this.showError(o);return}}this.hideError();try{let o=await(await fetch(this.endpoint,{method:this.method,body:i})).json();if(o.error){this.showError(o.error);return}o.redirect&&(window.location.href=o.redirect)}catch{this.showError("Something went wrong \u{1F615}")}})}addValidator(r){this.validators.push(r)}showError(r){this.errorBox.classList.contains("flex")||(this.errorBox.classList.remove("hidden"),this.errorBox.classList.add("flex")),this.errorMessage.textContent=r}hideError(){this.errorBox.classList.contains("hidden")||(this.errorBox.classList.add("hidden"),this.errorBox.classList.remove("flex"))}},s={required:t=>r=>r[t]?"":`${t} cannot be empty`,minLength:(t,r)=>e=>e[t]&&e[t].length<r?`${t} must be at least ${r} characters long`:"",pattern:(t,r,e)=>i=>i[t]&&!r.test(i[t])?e:"",passwordMatch:(t,r)=>e=>e[t]&&e[r]&&e[t]!==e[r]?"Passwords do not match":"",custom:t=>t};function g(){let t="login-form";if(!a.formExists(t))return;let r=new a({formId:t,errorBoxId:"login-error",errorMessageId:"login-error-message",endpoint:"/login"});r.addValidator(s.required("username")),r.addValidator(s.required("password")),r.addValidator(s.minLength("password",8)),r.addValidator(s.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.tryAttach()}function c(){let t="registration-form";if(!a.formExists(t))return;let r=new a({formId:t,errorBoxId:"register-error",errorMessageId:"register-error-message",endpoint:"/register"});r.addValidator(s.required("username")),r.addValidator(s.required("email")),r.addValidator(s.required("password")),r.addValidator(s.required("password2")),r.addValidator(s.minLength("password",8)),r.addValidator(s.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.addValidator(s.pattern("email",/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address")),r.addValidator(s.passwordMatch("password","password2")),r.tryAttach()}async function l(){console.log("\u{1F913}"),g(),c()}l();})();
