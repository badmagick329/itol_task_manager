"use strict";(()=>{var i=class{constructor({formId:r,errorBoxId:s,errorMessageId:o,endpoint:d,method:n}){this.validators=[];this.method="POST";let a=document.getElementById(s),l=document.getElementById(o);if(!a||!l)throw new Error(`Error box or message element not found. ${s}, ${o}`);this.formId=r,this.errorBox=a,this.errorMessage=l,this._endpoint=d,n&&(this.method=n)}static formExists(r){let s=document.getElementById(r);return s!==null&&s instanceof HTMLFormElement}tryAttach(){let r=document.getElementById(this.formId);r&&r.addEventListener("submit",async s=>{s.preventDefault();let o=new FormData(r),d={};o.forEach((n,a)=>{typeof n=="string"&&(d[a]=n.trim())});for(let n of this.validators){let a=n(d);if(a){this.showError(a);return}}this.hideError();try{let a=await(await fetch(this.endpoint,{method:this.method,body:o})).json();if(a.error){this.showError(a.error);return}a.redirect&&(window.location.href=a.redirect)}catch{this.showError("Something went wrong \u{1F615}")}})}addValidator(r){this.validators.push(r)}get endpoint(){if(this.method==="POST")return this._endpoint;let r=window.location.href.split("/");return`${this._endpoint}/${r[r.length-1]}`}showError(r){this.errorBox.classList.contains("flex")||(this.errorBox.classList.remove("hidden"),this.errorBox.classList.add("flex")),this.errorMessage.textContent=r}hideError(){this.errorBox.classList.contains("hidden")||(this.errorBox.classList.add("hidden"),this.errorBox.classList.remove("flex"))}},e={required:t=>r=>r[t]?"":`${t} cannot be empty`,minLength:(t,r)=>s=>s[t]&&s[t].length<r?`${t} must be at least ${r} characters long`:"",pattern:(t,r,s)=>o=>o[t]&&!r.test(o[t])?s:"",passwordMatch:(t,r)=>s=>s[t]&&s[r]&&s[t]!==s[r]?"Passwords do not match":"",custom:t=>t};function m(){let t="create-task-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"create-task-error",errorMessageId:"create-task-error-message",endpoint:"/task"});r.addValidator(e.required("title")),r.addValidator(e.required("due_date")),r.addValidator(e.required("status")),r.tryAttach()}function c(){let t=document.getElementById("task-status-filter");if(!t)return;let r=document.querySelectorAll("[data-task-status]");r.length!==0&&t.addEventListener("change",s=>{let o=s.target.value;r.forEach(d=>{let n=d.dataset.taskStatus;o==="All"||n===o?E(d):h(d)})})}function h(t){t.classList.contains("flex")&&(t.classList.add("hidden"),t.classList.remove("flex"))}function E(t){t.classList.contains("hidden")&&(t.classList.remove("hidden"),t.classList.add("flex"))}function u(){let t=document.querySelectorAll("[data-delete-task-id]");t.length!==0&&t.forEach(r=>{r.addEventListener("click",async s=>{s.preventDefault();let o=r.dataset.deleteTaskId;if(!o)return;let n=await(await fetch(`/task/${o}`,{method:"DELETE"})).json();if(n.error){alert(`Error deleting task: ${n.error}`);return}window.location.reload()})})}function f(){let t="edit-task-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"edit-task-error",errorMessageId:"edit-task-error-message",endpoint:"/task",method:"PUT"});r.addValidator(e.required("title")),r.addValidator(e.required("due_date")),r.addValidator(e.required("status")),r.tryAttach()}function p(){let t="login-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"login-error",errorMessageId:"login-error-message",endpoint:"/login"});r.addValidator(e.required("username")),r.addValidator(e.required("password")),r.addValidator(e.minLength("password",8)),r.addValidator(e.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.tryAttach()}function g(){let t="registration-form";if(!i.formExists(t))return;let r=new i({formId:t,errorBoxId:"register-error",errorMessageId:"register-error-message",endpoint:"/register"});r.addValidator(e.required("username")),r.addValidator(e.required("email")),r.addValidator(e.required("password")),r.addValidator(e.required("password2")),r.addValidator(e.minLength("password",8)),r.addValidator(e.pattern("username",/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores")),r.addValidator(e.pattern("email",/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address")),r.addValidator(e.passwordMatch("password","password2")),r.tryAttach()}async function L(){console.log("\u{1F913}"),p(),g(),m(),f(),u(),c()}L();})();
